var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,d){b.raw=d;return b};$jscomp.arrayIteratorImpl=function(b){var d=0;return function(){return d<b.length?{done:!1,value:b[d++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var d="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return d?d.call(b):$jscomp.arrayIterator(b)};
$jscomp.arrayFromIterator=function(b){for(var d,a=[];!(d=b.next()).done;)a.push(d.value);return a};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var d=0;d<b.length;++d){var a=b[d];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.checkEs6ConformanceViaProxy=function(){try{var b={},d=Object.create(new $jscomp.global.Proxy(b,{get:function(a,c,e){return a==b&&"q"==c&&e==d}}));return!0===d.q}catch(a){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,a){if(b==Array.prototype||b==Object.prototype)return b;b[d]=a.value;return b};$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};
$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,d){var a=$jscomp.propertyToPolyfillSymbol[d];if(null==a)return b[d];a=b[a];return void 0!==a?a:b[d]};$jscomp.polyfill=function(b,d,a,c){d&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,d,a,c):$jscomp.polyfillUnisolated(b,d,a,c))};
$jscomp.polyfillUnisolated=function(b,d,a,c){a=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var e=b[c];if(!(e in a))return;a=a[e]}b=b[b.length-1];c=a[b];d=d(c);d!=c&&null!=d&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:d})};
$jscomp.polyfillIsolated=function(b,d,a,c){var e=b.split(".");b=1===e.length;c=e[0];c=!b&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var k=0;k<e.length-1;k++){var h=e[k];if(!(h in c))return;c=c[h]}e=e[e.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?c[e]:null;d=d(a);null!=d&&(b?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:d}):d!==a&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(c,e,{configurable:!0,writable:!0,value:d})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(b){if(b)return b;var d=function(e,k){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:k})};d.prototype.toString=function(){return this.$jscomp$symbol$id_};var a=0,c=function(e){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new d("jscomp_symbol_"+(e||"")+"_"+a++,e)};return c},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(b){if(b)return b;b=Symbol("Symbol.iterator");for(var d="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<d.length;a++){var c=$jscomp.global[d[a]];"function"===typeof c&&"function"!=typeof c.prototype[b]&&$jscomp.defineProperty(c.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return b},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(b){b={next:b};b[Symbol.iterator]=function(){return this};return b};$jscomp.owns=function(b,d){return Object.prototype.hasOwnProperty.call(b,d)};
$jscomp.polyfill("WeakMap",function(b){function d(){if(!b||!Object.seal)return!1;try{var f=Object.seal({}),l=Object.seal({}),n=new b([[f,2],[l,3]]);if(2!=n.get(f)||3!=n.get(l))return!1;n.delete(f);n.set(l,4);return!n.has(f)&&4==n.get(l)}catch(p){return!1}}function a(){}function c(f){var l=typeof f;return"object"===l&&null!==f||"function"===l}function e(f){if(!$jscomp.owns(f,h)){var l=new a;$jscomp.defineProperty(f,h,{value:l})}}function k(f){if(!$jscomp.ISOLATE_POLYFILLS){var l=Object[f];l&&(Object[f]=
function(n){if(n instanceof a)return n;Object.isExtensible(n)&&e(n);return l(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(d())return b;var h="$jscomp_hidden_"+Math.random();k("freeze");k("preventExtensions");k("seal");var m=0,g=function(f){this.id_=(m+=Math.random()+1).toString();if(f){f=$jscomp.makeIterator(f);for(var l;!(l=f.next()).done;)l=l.value,this.set(l[0],l[1])}};g.prototype.set=function(f,l){if(!c(f))throw Error("Invalid WeakMap key");
e(f);if(!$jscomp.owns(f,h))throw Error("WeakMap key fail: "+f);f[h][this.id_]=l;return this};g.prototype.get=function(f){return c(f)&&$jscomp.owns(f,h)?f[h][this.id_]:void 0};g.prototype.has=function(f){return c(f)&&$jscomp.owns(f,h)&&$jscomp.owns(f[h],this.id_)};g.prototype.delete=function(f){return c(f)&&$jscomp.owns(f,h)&&$jscomp.owns(f[h],this.id_)?delete f[h][this.id_]:!1};return g},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(b){function d(){if($jscomp.ASSUME_NO_NATIVE_MAP||!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),f=new b($jscomp.makeIterator([[g,"s"]]));if("s"!=f.get(g)||1!=f.size||f.get({x:4})||f.set({x:4},"t")!=f||2!=f.size)return!1;var l=f.entries(),n=l.next();if(n.done||n.value[0]!=g||"s"!=n.value[1])return!1;n=l.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!l.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(d())return b;var a=new WeakMap,c=function(g){this.data_={};this.head_=h();this.size=0;if(g){g=$jscomp.makeIterator(g);for(var f;!(f=g.next()).done;)f=f.value,this.set(f[0],f[1])}};c.prototype.set=function(g,f){g=0===g?0:g;var l=e(this,g);l.list||(l.list=this.data_[l.id]=[]);l.entry?l.entry.value=f:(l.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:g,value:f},l.list.push(l.entry),
this.head_.previous.next=l.entry,this.head_.previous=l.entry,this.size++);return this};c.prototype.delete=function(g){g=e(this,g);return g.entry&&g.list?(g.list.splice(g.index,1),g.list.length||delete this.data_[g.id],g.entry.previous.next=g.entry.next,g.entry.next.previous=g.entry.previous,g.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=h();this.size=0};c.prototype.has=function(g){return!!e(this,g).entry};c.prototype.get=function(g){return(g=
e(this,g).entry)&&g.value};c.prototype.entries=function(){return k(this,function(g){return[g.key,g.value]})};c.prototype.keys=function(){return k(this,function(g){return g.key})};c.prototype.values=function(){return k(this,function(g){return g.value})};c.prototype.forEach=function(g,f){for(var l=this.entries(),n;!(n=l.next()).done;)n=n.value,g.call(f,n[1],n[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var e=function(g,f){var l=f&&typeof f;"object"==l||"function"==l?a.has(f)?l=a.get(f):
(l=""+ ++m,a.set(f,l)):l="p_"+f;var n=g.data_[l];if(n&&$jscomp.owns(g.data_,l))for(g=0;g<n.length;g++){var p=n[g];if(f!==f&&p.key!==p.key||f===p.key)return{id:l,list:n,index:g,entry:p}}return{id:l,list:n,index:-1,entry:void 0}},k=function(g,f){var l=g.head_;return $jscomp.iteratorPrototype(function(){if(l){for(;l.head!=g.head_;)l=l.previous;for(;l.next!=l.head;)return l=l.next,{done:!1,value:f(l)};l=null}return{done:!0,value:void 0}})},h=function(){var g={};return g.previous=g.next=g.head=g},m=0;
return c},"es6","es3");
$jscomp.polyfill("Set",function(b){function d(){if($jscomp.ASSUME_NO_NATIVE_SET||!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),e=new b($jscomp.makeIterator([c]));if(!e.has(c)||1!=e.size||e.add(c)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var k=e.entries(),h=k.next();if(h.done||h.value[0]!=c||h.value[1]!=c)return!1;h=k.next();return h.done||h.value[0]==c||4!=h.value[0].x||h.value[1]!=h.value[0]?!1:k.next().done}catch(m){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(d())return b;var a=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var e;!(e=c.next()).done;)this.add(e.value)}this.size=this.map_.size};a.prototype.add=function(c){c=0===c?0:c;this.map_.set(c,c);this.size=this.map_.size;return this};a.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=
function(c){return this.map_.has(c)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};a.prototype.keys=a.prototype.values;a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(c,e){var k=this;this.map_.forEach(function(h){return c.call(e,h,h,k)})};return a},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function d(){this.batch_=null}function a(h){return h instanceof e?h:new e(function(m,g){m(h)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;d.prototype.asyncExecute=function(h){if(null==this.batch_){this.batch_=[];var m=this;this.asyncExecuteFunction(function(){m.executeBatch_()})}this.batch_.push(h)};var c=$jscomp.global.setTimeout;d.prototype.asyncExecuteFunction=function(h){c(h,0)};d.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var h=
this.batch_;this.batch_=[];for(var m=0;m<h.length;++m){var g=h[m];h[m]=null;try{g()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};d.prototype.asyncThrow_=function(h){this.asyncExecuteFunction(function(){throw h;})};var e=function(h){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var m=this.createResolveAndReject_();try{h(m.resolve,m.reject)}catch(g){m.reject(g)}};e.prototype.createResolveAndReject_=function(){function h(f){return function(l){g||(g=!0,f.call(m,l))}}var m=this,g=!1;
return{resolve:h(this.resolveTo_),reject:h(this.reject_)}};e.prototype.resolveTo_=function(h){if(h===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof e)this.settleSameAsPromise_(h);else{a:switch(typeof h){case "object":var m=null!=h;break a;case "function":m=!0;break a;default:m=!1}m?this.resolveToNonPromiseObj_(h):this.fulfill_(h)}};e.prototype.resolveToNonPromiseObj_=function(h){var m=void 0;try{m=h.then}catch(g){this.reject_(g);return}"function"==typeof m?
this.settleSameAsThenable_(m,h):this.fulfill_(h)};e.prototype.reject_=function(h){this.settle_(2,h)};e.prototype.fulfill_=function(h){this.settle_(1,h)};e.prototype.settle_=function(h,m){if(0!=this.state_)throw Error("Cannot settle("+h+", "+m+"): Promise already settled in state"+this.state_);this.state_=h;this.result_=m;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var h=0;h<this.onSettledCallbacks_.length;++h)k.asyncExecute(this.onSettledCallbacks_[h]);
this.onSettledCallbacks_=null}};var k=new d;e.prototype.settleSameAsPromise_=function(h){var m=this.createResolveAndReject_();h.callWhenSettled_(m.resolve,m.reject)};e.prototype.settleSameAsThenable_=function(h,m){var g=this.createResolveAndReject_();try{h.call(m,g.resolve,g.reject)}catch(f){g.reject(f)}};e.prototype.then=function(h,m){function g(p,u){return"function"==typeof p?function(t){try{f(p(t))}catch(r){l(r)}}:u}var f,l,n=new e(function(p,u){f=p;l=u});this.callWhenSettled_(g(h,f),g(m,l));return n};
e.prototype.catch=function(h){return this.then(void 0,h)};e.prototype.callWhenSettled_=function(h,m){function g(){switch(f.state_){case 1:h(f.result_);break;case 2:m(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?k.asyncExecute(g):this.onSettledCallbacks_.push(g)};e.resolve=a;e.reject=function(h){return new e(function(m,g){g(h)})};e.race=function(h){return new e(function(m,g){for(var f=$jscomp.makeIterator(h),l=f.next();!l.done;l=f.next())a(l.value).callWhenSettled_(m,
g)})};e.all=function(h){var m=$jscomp.makeIterator(h),g=m.next();return g.done?a([]):new e(function(f,l){function n(t){return function(r){p[t]=r;u--;0==u&&f(p)}}var p=[],u=0;do p.push(void 0),u++,a(g.value).callWhenSettled_(n(p.length-1),l),g=m.next();while(!g.done)})};return e},"es6","es3");$jscomp.polyfill("Object.is",function(b){return b?b:function(d,a){return d===a?0!==d||1/d===1/a:d!==d&&a!==a}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(d,a){var c=this;c instanceof String&&(c=String(c));var e=c.length;a=a||0;for(0>a&&(a=Math.max(a+e,0));a<e;a++){var k=c[a];if(k===d||Object.is(k,d))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(b,d,a){if(null==b)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return b+""};$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(d,a){return-1!==$jscomp.checkStringArgs(this,d,"includes").indexOf(d,a||0)}},"es6","es3");
$jscomp.polyfill("Object.values",function(b){return b?b:function(d){var a=[],c;for(c in d)$jscomp.owns(d,c)&&a.push(d[c]);return a}},"es8","es3");$jscomp.iteratorFromArray=function(b,d){b instanceof String&&(b+="");var a=0,c=!1,e={next:function(){if(!c&&a<b.length){var k=a++;return{value:d(k,b[k]),done:!1}}c=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(d){return d})}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(d,a){return a})}},"es8","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(d,a,c){var e=this.length||0;0>a&&(a=Math.max(0,e+a));if(null==c||c>e)c=e;c=Number(c);0>c&&(c=Math.max(0,e+c));for(a=Number(a||0);a<c;a++)this[a]=d;return this}},"es6","es3");$jscomp.typedArrayFill=function(b){return b?b:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");var map;
function setMap(){var b=d3.select("#world").style("width",width).style("height",height).style("left",""+(window.innerWidth-width)/2);map=L.map("world",{zoomControl:!1}).setView([-.2858,.7068],1);mapLink='<a href="https://openstreetmap.org">OpenStreetMap</a>';L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; "+mapLink+" | DIFID | CEMAC   <br> ",maxZoom:17,minZoom:1}).addTo(map);map.dragging.disable();map.on("zoomstart",function(){context.clearRect(0,0,width,height)});
map.on("zoomend",draw);b.append("button").classed("recentre",!0).text("ReCentre").on("click",function(){map._resetView([-.2858,.7868],1);draw()})};function openNav(b){document.getElementById(b).style.width="100%"}function closeNav(b){document.getElementById(b).style.width="0"}function switchview(){fadeout(["canvas","#world"],duration=500,delay=0);data.carto=!data.carto;d3.select("#L1").text(data.carto?"t-SNE Map View":"World View");draw();data.carto?fadein(["canvas","#world"],duration=2E3,delay=500):(data.makeAnnotations=void 0,label(),fadein(["canvas"],duration=2E3,delay=500));imageData=void 0}
function access(b){x=document.getElementById(b);"true"===(x.getAttribute("state")||!1)?(fadeout(["#"+b]),fadein(["#overlay","canvas"],delay=1E3),x.style.visibility="hidden",x.transition="visibility 0.3s linear,opacity 0.3s linear",x.setAttribute("state",!1)):(fadeout(["#overlay","canvas"]),fadein(["#"+b],delay=1E3),x.style.visibility="visible",x.transition="visibility 0.3s linear,opacity 0.3s linear",x.setAttribute("state",!0))}
function fadeout(b,d,a){d=void 0===d?750:d;a=void 0===a?0:a;b.forEach(function(c){d3.selectAll(c).transition(d3.transition().duration(d).ease(d3.easeLinear).delay(a)).styleTween("opacity",function(){return function(e){return 1-e}})})}function fadein(b,d,a){d=void 0===d?750:d;a=void 0===a?0:a;b.forEach(function(c){d3.selectAll(c).transition(d3.transition().duration(d).ease(d3.easeLinear).delay(a)).styleTween("opacity",function(){return function(e){return e}})})}
function save(){var b=new Set([].concat($jscomp.arrayFromIterable(resbox.querySelectorAll("input:checked"))).map(function(d){return d.value}));data.filtered=data.tsne.filter(function(d){return b.has(d.doc_id)});1>data.filtered.length&&(data.filtered=void 0);draw();closeNav("mySidenav")}function clear(){[].concat($jscomp.arrayFromIterable(resbox.querySelectorAll("input:checked"))).map(function(b){return b.checked=!1})}
function sall(){[].concat($jscomp.arrayFromIterable(resbox.querySelectorAll("input"))).map(function(b){return b.checked=!0})}var resbox=document.getElementById("titleresults");
document.getElementById("titlesearch").addEventListener("keyup",function(b){b.preventDefault();13===b.keyCode&&(b=document.getElementById("titlesearch").value,results=fuzzysort.go(b,window.data.title,{allowTypo:!1,threshold:-109,keys:["title"]}),resbox.innerHTML="",results.map(function(d){var a=document.createElement("INPUT");a.setAttribute("type","checkbox");a.value=d.obj.id;var c=document.createElement("label");c.innerHTML=fuzzysort.highlight(d[0]);c.appendChild(a);resbox.appendChild(c)}))});table2Tree=function(b,d,a){var c=function(e){return void 0===a?e.length:a instanceof Function?a(e):d3.sum(e,function(k){return+k[a]})};return rollupsToTree(d3.rollups.apply(d3,$jscomp.arrayFromIterable([b,c].concat.apply([b,c],$jscomp.arrayFromIterable(d.map(function(e){return function(k){return k[e]}}))))))};
rollupsToTree=function(b){function d(c){if(c)return c.map(a)}var a=function(c){var e={name:c[0]};Array.isArray(c[1])?e.children=d(c[1]):e.value=c[1];return e};return{name:"",children:Array.isArray(b)?d(b):[{name:"",value:b}]}};
function draw_topics(b,d){function a(l){b.treeData=g(f);var n=b.treeData.descendants(),p=b.treeData.descendants().slice(1);b.topicfilter=n.filter(function(r){return!r.ignore&3===r.depth});sliderchange();n.forEach(function(r){r.y=180*r.depth});var u=h.selectAll("g.node").data(n,function(r){return r.id||(r.id=++m)}),t=u.enter().append("g").attr("class","node").attr("transform",function(r){return"translate("+l.y0+","+l.x0+")"}).on("click",e);t.append("circle").attr("class","node").attr("r",1E-6).style("fill",
function(r){return r._children?"grey":"#fff"});t.append("text").attr("dy",".35em").attr("x",function(r){return r.children||r._children?-13:13}).attr("text-anchor",function(r){return r.children||r._children?"end":"start"}).text(function(r){return r.data.name});t=t.merge(u);t.transition().duration(750).attr("transform",function(r){return"translate("+(r.y+30)+","+r.x+")"});t.select("circle.node").attr("r",function(r){return 5*(4-r.depth)}).style("fill",function(r){return r._children?"grey":"#fff"}).attr("cursor",
"pointer");u=u.exit().transition().duration(750).attr("transform",function(r){return"translate("+(l.y+30)+","+l.x+")"}).remove();u.select("circle").attr("r",1E-6);u.select("text").style("fill-opacity",1E-6);p=h.selectAll("path.link").data(p,function(r){return r.id});p.enter().insert("path","g").attr("class","link").attr("d",function(r){r={x:l.x0,y:l.y0};return c(r,r)}).merge(p).transition().duration(750).attr("d",function(r){return c(r,r.parent)});p.exit().transition().duration(750).attr("d",function(r){r=
{x:l.x,y:l.y};return c(r,r)}).remove();n.forEach(function(r){r.x0=r.x;r.y0=r.y})}function c(l,n){return path="M "+l.y+" "+l.x+"\n          C "+(l.y+n.y)/2+" "+l.x+",\n            "+(l.y+n.y)/2+" "+n.x+",\n            "+n.y+" "+n.x}function e(l){if(0===l.depth)return!1;if(void 0===l.children)return l.ignore?(d3.select(this).select("circle").style("stroke","steelblue"),d3.select(this).select("text").style("opacity","1"),l.ignore=!1):(d3.select(this).select("circle").style("stroke","#222"),d3.select(this).select("text").style("opacity",
"0.2"),l.ignore=!0),a(l);l.children?(l._children=l.children,l.children=null,d3.select(this).select("circle").style("stroke","#222")):(l.children=l._children.map(function(n){n.ignore=!1;return n}),l._children=null,d3.select(this).select("circle").style("stroke","steelblue"));a(l)}b.treeData=table2Tree(b.hierarchy,["l1","l2","l3"],function(l){return d3.sum(l,function(n){return parseFloat(n.id)})});var k=d3.select(".mainCanvas").node().offsetLeft,h=d3.select("#topicselector").attr("transform","translate("+
k+",0)").style("opacity",0).attr("width",d).attr("height",d),m=0,g=d3.tree().size([height,d]);var f=d3.hierarchy(b.treeData,function(l){return l.children});f.x0=height/2;f.y0=0;a(f)};function fuzzysortNew(b){var d={single:function(a,c,e){if(!a)return null;isObj(a)||(a=d.getPreparedSearch(a));if(!c)return null;isObj(c)||(c=d.getPrepared(c));return((e&&void 0!==e.allowTypo?e.allowTypo:b&&void 0!==b.allowTypo?b.allowTypo:1)?d.algorithm:d.algorithmNoTypo)(a,c,a[0])},go:function(a,c,e){if(!a)return noResults;a=d.prepareSearch(a);var k=a[0],h=e&&e.threshold||b&&b.threshold||-9007199254740991,m=e&&e.limit||b&&b.limit||9007199254740991,g=(e&&void 0!==e.allowTypo?e.allowTypo:b&&void 0!==
b.allowTypo?b.allowTypo:1)?d.algorithm:d.algorithmNoTypo,f=0,l=0,n=c.length;if(e&&e.keys){var p=e.scoreFn||defaultScoreFn;e=e.keys;var u=e.length;for(--n;0<=n;--n){for(var t=c[n],r=Array(u),y=u-1;0<=y;--y){var A=e[y],v=getValue(t,A);v?(isObj(v)||(v=d.getPrepared(v)),r[y]=g(a,v,k)):r[y]=null}r.obj=t;A=p(r);null===A||A<h||(r.score=A,f<m?(q.add(r),++f):(++l,A>q.peek().score&&q.replaceTop(r)))}}else if(e&&e.key)for(A=e.key,--n;0<=n;--n){if(t=c[n],v=getValue(t,A))isObj(v)||(v=d.getPrepared(v)),p=g(a,v,
k),null===p||p.score<h||(p={target:p.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:p.score,indexes:p.indexes,obj:t},f<m?(q.add(p),++f):(++l,p.score>q.peek().score&&q.replaceTop(p)))}else for(--n;0<=n;--n)if(v=c[n])isObj(v)||(v=d.getPrepared(v)),p=g(a,v,k),null===p||p.score<h||(f<m?(q.add(p),++f):(++l,p.score>q.peek().score&&q.replaceTop(p)));if(0===f)return noResults;a=Array(f);for(n=f-1;0<=n;--n)a[n]=q.poll();a.total=f+l;return a},goAsync:function(a,c,e){var k=!1,h=new Promise(function(m,
g){function f(){if(k)return g("canceled");var v=Date.now();if(e&&e.keys)for(var w=e.scoreFn||defaultScoreFn,F=e.keys,G=F.length;0<=p;--p){for(var B=c[p],C=Array(G),D=G-1;0<=D;--D){var E=F[D],z=getValue(B,E);z?(isObj(z)||(z=d.getPrepared(z)),C[D]=r(a,z,l)):C[D]=null}C.obj=B;B=w(C);if(null!==B&&!(B<u)&&(C.score=B,y<t?(n.add(C),++y):(++A,B>n.peek().score&&n.replaceTop(C)),0===p%1E3&&10<=Date.now()-v)){isNode?setImmediate(f):setTimeout(f);return}}else if(e&&e.key)for(E=e.key;0<=p;--p){if(B=c[p],z=getValue(B,
E))if(isObj(z)||(z=d.getPrepared(z)),w=r(a,z,l),null!==w&&!(w.score<u)&&(w={target:w.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:w.score,indexes:w.indexes,obj:B},y<t?(n.add(w),++y):(++A,w.score>n.peek().score&&n.replaceTop(w)),0===p%1E3&&10<=Date.now()-v)){isNode?setImmediate(f):setTimeout(f);return}}else for(;0<=p;--p)if(z=c[p])if(isObj(z)||(z=d.getPrepared(z)),w=r(a,z,l),null!==w&&!(w.score<u)&&(y<t?(n.add(w),++y):(++A,w.score>n.peek().score&&n.replaceTop(w)),0===p%1E3&&10<=Date.now()-
v)){isNode?setImmediate(f):setTimeout(f);return}if(0===y)return m(noResults);v=Array(y);for(w=y-1;0<=w;--w)v[w]=n.poll();v.total=y+A;m(v)}if(!a)return m(noResults);a=d.prepareSearch(a);var l=a[0],n=fastpriorityqueue(),p=c.length-1,u=e&&e.threshold||b&&b.threshold||-9007199254740991,t=e&&e.limit||b&&b.limit||9007199254740991,r=(e&&void 0!==e.allowTypo?e.allowTypo:b&&void 0!==b.allowTypo?b.allowTypo:1)?d.algorithm:d.algorithmNoTypo,y=0,A=0;isNode?setImmediate(f):f()});h.cancel=function(){k=!0};return h},
highlight:function(a,c,e){if(null===a)return null;void 0===c&&(c="<b>");void 0===e&&(e="</b>");var k="",h=0,m=!1,g=a.target,f=g.length;a=a.indexes;for(var l=0;l<f;++l){var n=g[l];if(a[h]===l){if(++h,m||(m=!0,k+=c),h===a.length){k+=n+e+g.substr(l+1);break}}else m&&(m=!1,k+=e);k+=n}return k},prepare:function(a){if(a)return{target:a,_targetLowerCodes:d.prepareLowerCodes(a),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(a){if(a)return{target:a,_targetLowerCodes:d.prepareLowerCodes(a),
_nextBeginningIndexes:d.prepareNextBeginningIndexes(a),score:null,indexes:null,obj:null}},prepareSearch:function(a){if(a)return d.prepareLowerCodes(a)},getPrepared:function(a){if(999<a.length)return d.prepare(a);var c=preparedCache.get(a);if(void 0!==c)return c;c=d.prepare(a);preparedCache.set(a,c);return c},getPreparedSearch:function(a){if(999<a.length)return d.prepareSearch(a);var c=preparedSearchCache.get(a);if(void 0!==c)return c;c=d.prepareSearch(a);preparedSearchCache.set(a,c);return c},algorithm:function(a,
c,e){for(var k=c._targetLowerCodes,h=a.length,m=k.length,g=0,f=0,l=0,n=0;;){var p=e===k[f];if(p){matchesSimple[n++]=f;++g;if(g===h)break;e=a[0===l?g:l===g?g+1:l===g-1?g-1:g]}++f;if(f>=m)for(;;){if(1>=g)return null;if(0===l){--g;f=a[g];if(e===f)continue;l=g}else{if(1===l)return null;--l;g=l;e=a[g+1];f=a[g];if(e===f)continue}n=g;f=matchesSimple[n-1]+1;break}}e=g=0;var u=!1,t=0,r=c._nextBeginningIndexes;null===r&&(r=c._nextBeginningIndexes=d.prepareNextBeginningIndexes(c.target));var y=f=0===matchesSimple[0]?
0:r[matchesSimple[0]-1];if(f!==m)for(;;)if(f>=m)if(0>=g){++e;if(e>h-2)break;a[e]!==a[e+1]&&(f=y)}else--g,f=matchesStrict[--t],f=r[f];else if(p=a[0===e?g:e===g?g+1:e===g-1?g-1:g]===k[f]){matchesStrict[t++]=f;++g;if(g===h){u=!0;break}++f}else f=r[f];u?(a=matchesStrict,k=t):(a=matchesSimple,k=n);g=0;n=-1;for(t=0;t<h;++t)f=a[t],n!==f-1&&(g-=f),n=f;u?0!==e&&(g+=-20):(g*=1E3,0!==l&&(g+=-20));c.score=g-(m-h);c.indexes=Array(k);for(t=k-1;0<=t;--t)c.indexes[t]=a[t];return c},algorithmNoTypo:function(a,c,e){for(var k=
c._targetLowerCodes,h=a.length,m=k.length,g=0,f=0,l=0;;){var n=e===k[f];if(n){matchesSimple[l++]=f;++g;if(g===h)break;e=a[g]}++f;if(f>=m)return null}g=0;e=!1;var p=0,u=c._nextBeginningIndexes;null===u&&(u=c._nextBeginningIndexes=d.prepareNextBeginningIndexes(c.target));f=0===matchesSimple[0]?0:u[matchesSimple[0]-1];if(f!==m)for(;;)if(f>=m){if(0>=g)break;--g;f=matchesStrict[--p];f=u[f]}else if(n=a[g]===k[f]){matchesStrict[p++]=f;++g;if(g===h){e=!0;break}++f}else f=u[f];e?(a=matchesStrict,l=p):a=matchesSimple;
k=0;g=-1;for(p=0;p<h;++p)f=a[p],g!==f-1&&(k-=f),g=f;e||(k*=1E3);c.score=k-(m-h);c.indexes=Array(l);for(p=l-1;0<=p;--p)c.indexes[p]=a[p];return c},prepareLowerCodes:function(a){var c=a.length,e=[];a=a.toLowerCase();for(var k=0;k<c;++k)e[k]=a.charCodeAt(k);return e},prepareBeginningIndexes:function(a){for(var c=a.length,e=[],k=0,h=!1,m=!1,g=0;g<c;++g){var f=a.charCodeAt(g),l=65<=f&&90>=f;f=l||97<=f&&122>=f||48<=f&&57>=f;var n=l&&!h||!m||!f;h=l;m=f;n&&(e[k++]=g)}return e},prepareNextBeginningIndexes:function(a){var c=
a.length;a=d.prepareBeginningIndexes(a);for(var e=[],k=a[0],h=0,m=0;m<c;++m)k>m?e[m]=k:(k=a[++h],e[m]=void 0===k?c:k);return e},cleanup:cleanup,new:fuzzysortNew};return d}var isNode="undefined"!==typeof require&&"undefined"===typeof window,preparedCache=new Map,preparedSearchCache=new Map,noResults=[];noResults.total=0;var matchesSimple=[],matchesStrict=[];function cleanup(){preparedCache.clear();preparedSearchCache.clear();matchesSimple=[];matchesStrict=[]}
function defaultScoreFn(b){for(var d=-9007199254740991,a=b.length-1;0<=a;--a){var c=b[a];null!==c&&(c=c.score,c>d&&(d=c))}return-9007199254740991===d?null:d}function getValue(b,d){var a=b[d];if(void 0!==a)return a;a=d;Array.isArray(d)||(a=d.split("."));d=a.length;for(var c=-1;b&&++c<d;)b=b[a[c]];return b}function isObj(b){return"object"===typeof b}
var fastpriorityqueue=function(){function b(){for(var e=0,k=d[e],h=1;h<a;){var m=h+1;e=h;m<a&&d[m].score<d[h].score&&(e=m);d[e-1>>1]=d[e];h=1+(e<<1)}for(h=e-1>>1;0<e&&k.score<d[h].score;h=(e=h)-1>>1)d[e]=d[h];d[e]=k}var d=[],a=0,c={};return c.add=function(e){var k=a;d[a++]=e;for(var h=k-1>>1;0<k&&e.score<d[h].score;h=(k=h)-1>>1)d[k]=d[h];d[k]=e},c.poll=function(){if(0!==a){var e=d[0];return d[0]=d[--a],b(),e}},c.peek=function(e){if(0!==a)return d[0]},c.replaceTop=function(e){d[0]=e;b()},c},q=fastpriorityqueue();function legend(b,d){b=b.filter(function(c){return c});var a=d3.select("#overlay");a.selectAll(".legend").remove();sg=a.append("g").classed("legend",!0);sg.selectAll("ldot").data(b).enter().append("circle").classed("legend",!0).attr("cx",20).attr("cy",function(c,e){return 30+25*e}).attr("r",3).style("float","right").style("fill",function(c){return d(c)});sg.selectAll("llab").data(b).enter().append("text").classed("legend",!0).attr("x",30).attr("y",function(c,e){return 30+25*e}).style("fill",function(c){return d(c)}).text(function(c){return c}).attr("text-anchor",
"left").style("alignment-baseline","middle")};function label(){data.carto&&switchview();if(data.makeAnnotations)return data.showlabel?(data.showlabel=!1,fadeout([".annotation-group"],duration=2700)):(data.showlabel=!0,fadein([".annotation-group"],duration=2700)),1;if(null!=d3.select(".annotation-group").node())return d3.select(".annotation-group").remove();data.showlabel=!1;var b=d3.annotationCalloutCircle,d=data.labels.filter(function(m){return m.left}),a=data.labels.filter(function(m){return!m.left}),c=height/(em*d.length),e=height/(em*a.length),
k=1,h=1;d=data.labels.map(function(m){if(m.left){var g=k*c*em;k+=1}else g=h*e*em,h+=1;var f="label_"+m.label.replace(/[&\s-\/\.]/g,"_");return{note:{title:"32",label:m.label,bgPadding:0,align:m.left?"right":"left"},data:{x1:m.cx,y1:m.cy},x:m.cx+shift.x,y:m.cy+shift.y,id:f,ny:g,nx:m.left?shift.x-20:20+shift.width+shift.x,className:f,subject:{radius:4}}});data.makeAnnotations=d3.annotation().editMode(!1).notePadding(1.01).type(b).accessors({}).annotations(d);d3.select("#overlay").append("g").attr("class",
"annotation-group").style("opacity",0).call(data.makeAnnotations);d3.selectAll(".annotation-connector").attr("opacity",.3);d3.selectAll(".annotation-note-label").style("pointer-events","auto").on("mouseover",function(){var m=d3.select(this);[].concat($jscomp.arrayFromIterable(m.node().parentElement.parentElement.parentElement.querySelectorAll("path, text"))).forEach(function(g){d3.select(g).classed("hilight",!0)})}).on("mouseout",function(){var m=d3.select(this);[].concat($jscomp.arrayFromIterable(m.node().parentElement.parentElement.parentElement.querySelectorAll("*"))).forEach(function(g){d3.select(g).classed("hilight",
!1)})})};function canvasmove(b){if(b){var d=b.layerPoint.x;b=b.layerPoint.y}else d=d3.event.layerX||d3.event.offsetX,b=d3.event.layerY||d3.event.offsetY;var a=hiddencontext.getImageData(d,b,1,1).data;a=data.nodeclr["rgb("+a[0]+","+a[1]+","+a[2]+")"];try{var c=data.info.get(""+a);title.text(c.title)}catch(e){tool.style("opacity",0)}data.carto||(void 0!=imageData?context.putImageData(imageData,0,0):imageData=context.getImageData(0,0,width,height),context.save(),context.globalAlpha=1,context.strokeStyle="#222",
context.beginPath(),context.lineWidth=2,context.moveTo(d-4,b-4),context.lineTo(d+4,b+4),context.moveTo(d+4,b-4),context.lineTo(d-4,b+4),context.stroke(),context.beginPath(),context.lineWidth=1.5,context.arc(d,b,20,0,2*Math.PI),context.stroke(),context.restore())}
function canvasdblclick(b){if(b){var d=b.layerPoint.x;b=b.layerPoint.y}else d=d3.event.layerX||d3.event.offsetX,b=d3.event.layerY||d3.event.offsetY;d=hiddencontext.getImageData(d,b,1,1).data;d=data.nodeclr["rgb("+d[0]+","+d[1]+","+d[2]+")"];try{var a=data.info.get(""+d);doi(a.wosarticle__di)}catch(c){}}
function mousesetup(b,d,a){d.on("mouseout",function(){tool.style("opacity",0);title.text("")});d.on("mousemove",canvasmove);a.on("mousemove",canvasmove);d.on("dblclick",canvasdblclick);a.on("dblclick",canvasdblclick)}
function zoomed(b){imageData=void 0;var d=[1,0,0,1,0,0];data.zoom=Math.pow(1/b.k,.5);data.zoom=1<=data.zoom?data.zoom:1;context.save();context.clearRect(0,0,width,height);context.translate(b.x,b.y);context.scale(b.k,b.k);hiddencontext.save();hiddencontext.clearRect(0,0,width,height);hiddencontext.translate(b.x,b.y);hiddencontext.scale(b.k,b.k);draw();context.restore();hiddencontext.restore();window.scroll(0,0);(function(a,c){d[4]+=d[0]*a+d[2]*c;d[5]+=d[1]*a+d[3]*c})(b.x,b.y);(function(a,c){d[0]*=
a;d[1]*=a;d[2]*=c;d[3]*=c})(b.k,b.k);try{data.makeAnnotations.annotations().forEach(function(a,c){c=a.data.x1;var e=a.data.y1;newX=c*d[0]+e*d[2]+d[4];newY=c*d[1]+e*d[3]+d[5];c=newX;e=newY;var k=d3.selectAll("."+a.id);Math.max(c,e)>width|0>Math.min(c,e)?k.attr("opacity",0):(k.attr("opacity",1),a.dx-=c-a.x+shift.x,a.x=c+shift.x,a.dy-=e-a.y,a.y=e)}),data.makeAnnotations.update()}catch(a){console.log(a)}}
function sliderchange(){window.data.filtered=window.data.tsne;if(window.data.topicfilter){var b=window.data.topicfilter.map(function(c){return c.data.name}),d=window.data.hierarchy.filter(function(c){return b.includes(c.l3)}).map(function(c){return c.id}),a=Math.pow(window.data.weight(parseFloat(document.getElementById("points").value)),2);window.data.filtered=window.data.filtered.filter(function(c){c=window.data.topics.get(c.doc_id);return c.score>a&d.includes(""+c.topic_id)})}else a=Math.pow(window.data.weight(parseFloat(document.getElementById("points").value)),
2),window.data.filtered=window.data.filtered.filter(function(c){return window.data.topics.get(c.doc_id).score>a});window.data.continentselection&&(console.log(data.continentselection,data.filtered),window.data.filtered=window.data.filtered.filter(function(c){c=window.data.info.get(c.doc_id).continent;return window.data.continentselection.includes(c)}));a=Math.pow(window.data.weight(parseFloat(document.getElementById("points").value)),2);window.data.filtered=window.data.filtered.filter(function(c){return window.data.topics.get(c.doc_id).score>
a});window.data.showlabel&&label();draw();imageData=void 0};var continentmap={"South America":"SA",Oceania:"OC","North America":"NA",Europe:"EU",Asia:"AS",Africa:"AF"};
function draw_world(b){var d=d3.geoGraticule(),a=d3.select(".mainCanvas").node().offsetLeft;a=d3.select("#countryselector").attr("transform","translate("+a+",0)").style("opacity",0).attr("width",width).attr("height",height);a.selectAll("g").remove();a.append("g");var c=d3.geoPeirceQuincuncial().fitSize([width,height],{type:"Sphere"}).rotate([20,-90,45]).precision(.1),e=d3.geoPath().projection(c);a.append("path").datum(d).attr("class","graticule").attr("fill","none").attr("stroke","#222").attr("opacity",
.13).attr("d",e);var k=topojson.feature(b,b.objects.continent).features;b=k.map(function(h){return c(d3.geoCentroid(h))});a.selectAll(".continent").data(k).enter().append("path").attr("d",e).attr("title",function(h,m){return h.properties.continent}).attr("id",function(h){return continentmap[h.properties.continent]}).attr("stroke",function(h){return d3.color(cmap(continentmap[h.properties.continent])).darker(.4).toString()}).on("click",function(h){return clist(continentmap[h.properties.continent])}).style("fill",
function(h,m){return cmap(continentmap[h.properties.continent])});a.selectAll(".name").data(b).enter().append("text").attr("x",function(h){return h[0]}).attr("y",function(h){return h[1]}).style("font-family","BalooDa").style("fill","whitesmoke").attr("text-anchor","middle").text(function(h,m){return k[m].properties.continent}).style("pointer-events","none");a.append("text").attr("x",10).attr("y",20).text("Click on continents to deselect/select them - then click on the red tab to return to previous plot").style("font-family",
"BalooDa").style("fill","#222").attr("text-anchor","left")}function clist(b){data.continentselection=data.continentselection||Object.values(continentmap);cnt=d3.selectAll("#"+b);data.continentselection.includes(cnt.attr("id"))?(data.continentselection=data.continentselection.filter(function(d){return d!=cnt.attr("id")}),cnt.attr("opacity",.3)):(data.continentselection.push(cnt.attr("id")),cnt.attr("opacity",1));showcselect()}
function showcselect(){context.clearRect(0,0,width,height);sliderchange()};var fail=0,em,div=document.getElementById("div");div.style.height="1em";em=div.offsetHeight;var imageData=void 0,data,shift,width=height=d3.min([window.innerWidth,window.innerHeight-40,window.innerWidth-300]);200>width&&alert("window size too small, please enlarge this!");var halfwidth=width/2,mainCanvas,hiddenCanvas,context,hiddencontext,tool,title,voronoi=d3.voronoi().extent([[-1,-1],[width+1,height+1]]);fuzzysort=fuzzysortNew();
var cmap=d3.scaleOrdinal("f9c80e f86624 ea3546 662e9b 36e0f7 3498db".split(" ").map(function(b){return"#"+b}));

d3.queue().defer(d3.csv, 'data/doc_information.csv') // documnet info [0]
  .defer(d3.csv, 'data/tsne_results.csv') // tsnelocations
  .defer(d3.csv, 'data/doctopic.csv')
  .defer(d3.csv, 'data/label_tsne.csv') //labelloc
  .defer(d3.csv, 'data/locations.csv')
  .defer(d3.json, 'continents.geojson')
  .defer(d3.csv, 'data/topic_hierarchy.csv')
  .await(load);
// d3.queue().defer(d3.csv,"../data/doc_information.csv").defer(d3.csv,"../data/tsne_results.csv").defer(d3.csv,"../data/doctopic.csv").defer(d3.csv,"../data/label_tsne.csv").defer(d3.csv,"../data/locations.csv").defer(d3.json,"continents.geojson").defer(d3.csv,"../data/topic_hierarchy.csv").await(load);

function load(b,d){for(var a=[],c=1;c<arguments.length;++c)a[c-1]=arguments[c];console.log("Loading...",a);data={};data.continent=[].concat($jscomp.arrayFromIterable(new Set(a[0].map(function(k){return k.continent}))));data.colours="f94144 f3722c f8961e f9c74f 90be6d 43aa8b 577590".split(" ").map(function(k){return"#"+k});data.info=new Map(a[0].map(function(k){k.c=data.colours[data.continent.indexOf(k.continent)];return[k.id,k]}));data.tsne=a[1].filter(function(k){return data.info.has(k.doc_id)}).map(function(k){[1,
2].forEach(function(h){h="tsne-"+h;k[h]=+k[h]});return k});data.carto=!1;data.x=d3.scaleLinear().domain(d3.extent(data.tsne.map(function(k){return k["tsne-1"]}))).range([0,width]);data.y=d3.scaleLinear().domain(d3.extent(data.tsne.map(function(k){return k["tsne-2"]}))).range([height,0]);data.tsne=data.tsne.map(function(k){k.tloc={x:data.x(k["tsne-1"]),y:data.y(k["tsne-2"])};return k});data.topics=new Map(a[2].map(function(k){Object.keys(k).forEach(function(h){k[h]=+k[h]});return[""+k.doc_id,k]}));
data.weight=d3.scaleLinear().range(d3.extent([].concat($jscomp.arrayFromIterable(data.topics.values())).map(function(k){return k.score}))).domain([100,0]);var e=width/2;data.labels=a[3].map(function(k){k.x=k.cx=data.x(k["tsne-1"]);k.y=k.cy=data.y(k["tsne-2"]);k.left=k.x<e;return k}).sort(function(k,h){return d3.ascending(k.y,h.y)});data.locations=new Map(a[4].map(function(k){return[k.doc_id,new L.LatLng(parseFloat(k.lat),parseFloat(k.lon))]}));data.title=[].concat($jscomp.arrayFromIterable(data.info.values())).map(function(k,
h){return{title:k.title.toLowerCase(),id:k.id}});data.hierarchy=a[6];mainCanvas=d3.select("#container").append("canvas").classed("mainCanvas",!0).attr("width",width).attr("height",height);hiddenCanvas=d3.select("#tooltip").append("canvas").classed("hiddenCanvas",!0).attr("width",width).attr("height",height);context=mainCanvas.node().getContext("2d");hiddencontext=hiddenCanvas.node().getContext("2d");tool=d3.select("#tooltip");title=d3.select("#title");draw_world(a[5]);setMap();mousesetup(hiddencontext,
mainCanvas,map);d3.select("canvas").call(d3.zoom().scaleExtent([.5,12]).translateExtent([[0,0],[width,height]]).extent([[0,0],[width,height]]).on("zoom",function(){return zoomed(d3.event.transform)}));shift=d3.select("canvas").node().getBoundingClientRect();draw_topics(data,width);label();label();zoomed({k:.6,x:.4*width/2,y:.4*width/2});d3.select("#title").text("");console.log("data loaded")}
function draw(){context.clearRect(0,0,width,height);hiddencontext.clearRect(0,0,width,height);var b=width/400,d=data.filtered||data.tsne;console.log("initial filtered datapoints",d.length);if(data.carto){var a="loc";d3.select(".annotation-group").remove();d=d.map(function(m){try{return m.loc=map.latLngToLayerPoint(data.locations.get(m.doc_id)),m}catch(g){return!1}}).filter(function(m){return m});mainCanvas.style("pointer-events","none");d3.select("#world").style("visibility","visible").style("pointer-events",
"auto")}else a="tloc",d3.select("#world").style("visibility","hidden"),mainCanvas.style("pointer-events","auto");var c=d.map(function(m){return[m[a].x+.01*Math.random(),m[a].y+.01*Math.random()]});console.log("points remaining",c.length);try{var e=voronoi(c).polygons();context.beginPath();c=0;for(var k=e.length;c<k;++c)drawCell(context,e[c]);context.strokeStyle="rgba(2,2,2,0.1)";context.stroke();fail=0}catch(m){fail+=1;console.log("failed voronoi",fail);if(10>fail)return draw();alert("Failed to load interactivity layer, please try another browser or refresh. To continue without point interactivity, Click OK")}var h=
[];d.forEach(function(m){context.globalAlpha=.5;context.beginPath();context.arc(m[a].x,m[a].y,b*data.zoom,0,2*Math.PI);m=data.info.get(m.doc_id).continent;h.push(m);context.fillStyle=cmap(m)||"black";context.fill()});legend([].concat($jscomp.arrayFromIterable(new Set(h))),cmap);data.nodeclr={};d.forEach(function(m,g){hiddencontext.beginPath();drawCell(hiddencontext,e[g]);g=genColor(g);data.nodeclr[g]=m.doc_id;hiddencontext.fillStyle=g;hiddencontext.fill()})}
function drawCell(b,d){if(!d)return!1;b.moveTo(d[0][0],d[0][1]);for(var a=1,c=d.length;a<c;++a)b.lineTo(d[a][0],d[a][1]);return!0}function genColor(b){var d=[];16777215>b&&(d.push(b&255),d.push((b&65280)>>8),d.push((b&16711680)>>16));return"rgb("+d.join(",")+")"}function doi(b){b="https://scholar.google.com/scholar?hl=en&as_sdt=0%2C5&q="+b.replace("/","%2F")+"&btnG=";console.log(b);window.open(b,"_blank").focus()};
